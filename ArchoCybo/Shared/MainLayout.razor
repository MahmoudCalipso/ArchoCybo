@inherits LayoutComponentBase
@using MudBlazor
@using Microsoft.AspNetCore.Components.Authorization
@using ArchoCybo.Services
@inject AuthStateProvider AuthStateProvider
@inject NavigationManager NavigationManager

<MudThemeProvider Theme="CurrentTheme" />

<CascadingAuthenticationState>
    <MudLayout>
        <MudAppBar Elevation="2" Color="Color.Primary">
            <MudText Typo="Typo.h6">ArchoCybo</MudText>
            <MudSpacer />
            <MudIconButton Icon="@(_isDark? Icons.Material.Filled.DarkMode : Icons.Material.Filled.LightMode)" Color="Color.Inherit" OnClick="ToggleTheme" />

            <AuthorizeView>
                <Authorized>
                    <MudText Typo="Typo.body2" Class="mr-3">Hello, @context.User.Identity?.Name</MudText>
                    <MudButton Variant="Variant.Text" Color="Color.Inherit" OnClick="Logout" StartIcon="@Icons.Material.Filled.Logout">Logout</MudButton>
                </Authorized>
                <NotAuthorized>
                    <MudButton Variant="Variant.Text" Color="Color.Inherit" Href="/login" StartIcon="@Icons.Material.Filled.Login">Login</MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </MudAppBar>

        <AuthorizeView>
            <Authorized>
                <MudDrawer ClipMode="DrawerClipMode.Always" Variant="DrawerVariant.Responsive" Open="true" Elevation="1" Class="mud-theme-background">
                    <MudNavMenu>
                        <MudNavLink Href="/" Match="Microsoft.AspNetCore.Components.Routing.NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Dashboard</MudNavLink>
                        <MudDivider Class="my-2" />
                        <MudNavLink Href="/database" Icon="@Icons.Material.Filled.Storage">Database Explorer</MudNavLink>
                        <MudNavLink Href="/query-builder" Icon="@Icons.Material.Filled.Code">Query Builder (Basic)</MudNavLink>
                        <MudNavLink Href="/query-builder-advanced" Icon="@Icons.Material.Filled.AutoFixHigh">Query Builder (Advanced)</MudNavLink>
                        <MudNavLink Href="/entity-manager" Icon="@Icons.Material.Filled.TableView">Entity Manager</MudNavLink>
                        <MudDivider Class="my-2" />
                        <MudNavLink Href="/projects" Icon="@Icons.Material.Filled.Folder">Projects</MudNavLink>
                        <MudNavLink Href="/users" Icon="@Icons.Material.Filled.Group">Users</MudNavLink>
                    </MudNavMenu>
                </MudDrawer>
            </Authorized>
        </AuthorizeView>

        <MudMainContent Class="pa-4">
            <MudContainer MaxWidth="MaxWidth.False">
                @Body
            </MudContainer>
        </MudMainContent>
    </MudLayout>
</CascadingAuthenticationState>

@code {
    bool _isDark = true;
    MudTheme DarkTheme = new MudTheme()
    {
        Palette = new Palette()
        {
            Black = "#27272f",
            Background = "#0d0d0d",
            Surface = "#121212",
            Primary = "#90caf9",
            Secondary = "#f48fb1",
            AppbarBackground = "#101010",
            DrawerBackground = "#0b0b0b",
            TextPrimary = "#e0e0e0"
        }
    };
    MudTheme LightTheme = new MudTheme()
    {
        Palette = new Palette()
        {
            Black = "#27272f",
            Background = "#ffffff",
            Surface = "#f4f6f8",
            Primary = "#1976d2",
            Secondary = "#9c27b0",
            AppbarBackground = "#1976d2",
            DrawerBackground = "#ffffff",
            TextPrimary = "#222222"
        }
    };
    MudTheme CurrentTheme => _isDark ? DarkTheme : LightTheme;
    void ToggleTheme()
    {
        _isDark = !_isDark;
    }
    void Logout()
    {
        AuthStateProvider.MarkUserAsLoggedOut();
        NavigationManager.NavigateTo("/login", true);
    }
}